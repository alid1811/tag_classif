# Classification Multilabel - Projet ML

Projet de classification multilabel pour l'analyse de probl√®mes de programmation. Ce projet permet d'entra√Æner et d'√©valuer diff√©rents mod√®les de machine learning pour classifier automatiquement des probl√®mes selon plusieurs cat√©gories.

## üìÅ Structure du Projet

```
ml-classification-project/
‚îÇ
‚îú‚îÄ‚îÄ cli.py                      # Interface en ligne de commande (CLI)
‚îú‚îÄ‚îÄ requirements.txt            # D√©pendances Python
‚îú‚îÄ‚îÄ README.md                   # Documentation
‚îÇ
‚îú‚îÄ‚îÄ src/                        # Code source
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # Initialisation du module
‚îÇ   ‚îú‚îÄ‚îÄ data.py                # Preprocessing des donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ models.py              # Classes de mod√®les
‚îÇ   ‚îú‚îÄ‚îÄ evaluation.py          # Calcul des m√©triques
‚îÇ   ‚îî‚îÄ‚îÄ train_model.py         # Entra√Ænement des mod√®les
‚îÇ
‚îú‚îÄ‚îÄ data/                       # Donn√©es brutes (fichiers JSON)
‚îÇ
‚îú‚îÄ‚îÄ saved_models/              # Mod√®les entra√Æn√©s sauvegard√©s
‚îÇ   ‚îú‚îÄ‚îÄ tfidf_logreg/
‚îÇ   ‚îî‚îÄ‚îÄ tfidf_minilm/
‚îÇ
‚îú‚îÄ‚îÄ reports/                    # Rapports d'√©valuation
‚îÇ   ‚îú‚îÄ‚îÄ tfidf_logreg/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ confusion_matrices/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report_TfidfLogReg.pdf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics_per_class.csv
‚îÇ   ‚îî‚îÄ‚îÄ tfidf_minilm/
‚îÇ
‚îî‚îÄ‚îÄ confusion_matrices/        # Matrices de confusion
```

## üöÄ Installation

### 1. Cloner le projet
```bash
git clone <votre-repo>
cd ml-classification-project
```

### 2. Cr√©er un environnement virtuel (recommand√©)
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate     # Windows
```

### 3. Installer les d√©pendances
```bash
pip install -r requirements.txt
```

## üìä Utilisation de la CLI

### Commandes Principales

#### 1. Entra√Æner un mod√®le TF-IDF + Logistic Regression
```bash
python cli.py train --model tfidf-logreg --data-dir ./data
```

#### 2. Entra√Æner un mod√®le TF-IDF + MiniLM
```bash
python cli.py train --model tfidf-minilm --data-dir ./data
```

#### 3. Entra√Æner avec augmentation des classes rares
```bash
python cli.py train --model tfidf-minilm --data-dir ./data --augment --custom-thresholds
```

#### 4. Pr√©dire sur de nouvelles questions
```bash
# Pr√©dire une ou plusieurs questions directement
python cli.py predict --model-dir ./saved_models/tfidf_logreg \
  --questions "What is the derivative of x^2?" "How to solve linear equations?"

# Pr√©dire depuis un fichier JSON
python cli.py predict --model-dir ./saved_models/tfidf_minilm \
  --input-file questions.json --output-file predictions.json

# Avec mode verbose pour voir les probabilit√©s
python cli.py predict --model-dir ./saved_models/tfidf_minilm \
  --questions "What is conditional probability?" --verbose

# Limiter au top 3 tags les plus probables
python cli.py predict --model-dir ./saved_models/tfidf_logreg \
  --input-file questions.json --top-k 3 --verbose

# Avec seuil de probabilit√© personnalis√©
python cli.py predict --model-dir ./saved_models/tfidf_minilm \
  --questions "What is Bayes theorem?" --threshold 0.3 --verbose
```

**Formats support√©s pour les fichiers d'entr√©e:**

```json
// Format 1: Liste simple de questions
[
  "What is the probability of rolling a 6?",
  "How to solve linear equations?",
  "Explain graph traversal algorithms"
]

// Format 2: Liste de dictionnaires
[
  {"question": "What is the probability of rolling a 6?", "id": 1},
  {"question": "How to solve linear equations?", "id": 2}
]
```

**Format de sortie (JSON):**
```json
[
  {
    "question": "What is the probability of rolling a 6?",
    "predicted_tags": ["probabilities", "math"],
    "probabilities": {
      "probabilities": 0.8532,
      "math": 0.6421
    }
  }
]
```

#### 5. Comparer les deux mod√®les
```bash
python cli.py compare --data-dir ./data
```

### Options Avanc√©es

```bash
# Param√®tres de split
python cli.py train --model tfidf-logreg --data-dir ./data --test-size 0.3 --random-state 123

# Param√®tres du mod√®le
python cli.py train --model tfidf-logreg --data-dir ./data --max-features 50000 --max-iter 300

# Personnaliser les r√©pertoires de sortie
python cli.py train --model tfidf-logreg --data-dir ./data --save-dir ./my_models --report-dir ./my_reports

# Sp√©cifier les tags rares √† augmenter
python cli.py train --model tfidf-minilm --data-dir ./data --augment --rare-tags probabilities games
```

### Aide
```bash
# Afficher l'aide g√©n√©rale
python cli.py --help

# Afficher l'aide pour une commande
python cli.py train --help
python cli.py compare --help
python cli.py predict --help
```

## üîß Modules Python

### 1. `data.py` - Preprocessing des donn√©es

**Fonctions principales:**

- `load_json_files(data_dir)`: Charge tous les fichiers JSON
- `preprocess_data(df)`: Pipeline complet de preprocessing
- `clean_text(text)`: Nettoie et normalise le texte
- `augment_rare_classes(X_train, Y_train, rare_tags)`: Augmente les classes rares

**Exemple d'utilisation:**
```python
from src.data import load_json_files, preprocess_data

# Charger les donn√©es
df_raw = load_json_files("data/")

# Preprocesser
df = preprocess_data(df_raw)
```

### 2. `models.py` - Classes de mod√®les

**Classes disponibles:**

#### TfidfLogRegClassifier
Mod√®le bas√© sur TF-IDF + Logistic Regression

```python
from src.models import TfidfLogRegClassifier

model = TfidfLogRegClassifier(max_features=30000, max_iter=200)
model.fit(X_train, y_train)
predictions = model.predict(X_test)
model.save("saved_models/my_model")
```

#### TfidfMiniLMClassifier
Mod√®le bas√© sur TF-IDF + MiniLM embeddings + Logistic Regression

```python
from src.models import TfidfMiniLMClassifier

model = TfidfMiniLMClassifier(max_features=30000, max_iter=300)
model.fit(X_train, y_train)

# Pr√©diction avec seuils personnalis√©s
thresholds = {'probabilities': 0.3, 'games': 0.3, 'geometry': 0.3}
predictions = model.predict_with_threshold(X_test, thresholds)
```

### 3. `evaluation.py` - √âvaluation des mod√®les

**Fonctions principales:**

- `evaluate_model(model, X_test, Y_test, class_names)`: Pipeline complet d'√©valuation
- `compute_classification_report(Y_true, Y_pred, class_names)`: Calcule les m√©triques
- `generate_confusion_matrices(Y_true, Y_pred, class_names)`: G√©n√®re les matrices
- `generate_pdf_report(...)`: Cr√©e un rapport PDF

**Exemple d'utilisation:**
```python
from src.evaluation import evaluate_model

results = evaluate_model(
    model=my_model,
    X_test=X_test,
    Y_test=Y_test,
    class_names=['math', 'graphs', 'strings'],
    output_dir="reports/my_evaluation",
    model_name="MyModel"
)

# Acc√©der aux r√©sultats
print(results['report_text'])
print(results['additional_metrics'])
```

### 4. `train_model.py` - Entra√Ænement et Pr√©diction

**Fonctions principales:**

- `train_tfidf_logreg(data_dir, ...)`: Entra√Æne TF-IDF + LogReg
- `train_tfidf_minilm(data_dir, ...)`: Entra√Æne TF-IDF + MiniLM
- `compare_models(data_dir, ...)`: Compare les mod√®les
- `predict_questions(questions, model_dir, ...)`: Pr√©dit les tags pour de nouvelles questions

**Exemple d'utilisation - Entra√Ænement:**
```python
from src.train_model import train_tfidf_logreg

results = train_tfidf_logreg(
    data_dir="data/",
    test_size=0.2,
    random_state=42,
    save_dir="saved_models/my_model",
    max_features=30000,
    max_iter=200
)

model = results['model']
evaluation_results = results['results']
```

**Exemple d'utilisation - Pr√©diction:**
```python
from src.train_model import predict_questions

# Pr√©dire sur une seule question
predictions = predict_questions(
    questions="What is the derivative of x^2?",
    model_dir="saved_models/tfidf_logreg"
)

# Pr√©dire sur plusieurs questions avec options
predictions = predict_questions(
    questions=[
        "What is conditional probability?",
        "How to implement a binary search tree?",
        "Explain Bayes theorem"
    ],
    model_dir="saved_models/tfidf_minilm",
    threshold=0.3,  # Seuil personnalis√©
    top_k=5        # Limiter √† 5 tags maximum
)

# Acc√©der aux r√©sultats
for pred in predictions:
    print(f"Tags: {pred['tags']}")
    print(f"Probabilities: {pred['probabilities']}")
```

**Param√®tres de `predict_questions`:**
- `questions` (str ou List[str]): Question(s) √† classifier
- `model_dir` (str): R√©pertoire contenant le mod√®le sauvegard√©
- `threshold` (float, optional): Seuil de probabilit√© (d√©faut: 0.5 ou seuils du mod√®le)
- `top_k` (int, optional): Nombre maximum de tags √† retourner

**Format de retour:**
```python
[
    {
        'tags': ['probabilities', 'math'],
        'probabilities': {
            'probabilities': 0.8532,
            'math': 0.6421
        }
    },
    ...
]
```

## üìà Classes Cibles

Le projet supporte la classification selon les cat√©gories suivantes:
- `math`: Probl√®mes math√©matiques
- `graphs`: Th√©orie des graphes
- `strings`: Manipulation de cha√Ænes
- `number theory`: Th√©orie des nombres
- `trees`: Structures d'arbres
- `geometry`: G√©om√©trie
- `games`: Th√©orie des jeux
- `probabilities`: Probabilit√©s

## üìä M√©triques d'√âvaluation

Le projet calcule automatiquement:
- **Precision, Recall, F1-Score** par classe et moyennes
- **Hamming Loss**: Proportion d'erreurs sur l'ensemble des labels
- **Exact Match Ratio**: Proportion de pr√©dictions parfaitement correctes
- **Matrices de confusion** pour chaque classe
- **Support**: Nombre d'exemples par classe

Tous les r√©sultats sont sauvegard√©s dans:
- Un fichier CSV avec les m√©triques par classe
- Un rapport PDF complet avec graphiques
- Des images PNG des matrices de confusion

## üéØ Strat√©gies d'Am√©lioration

### Augmentation des Classes Rares
Pour am√©liorer les performances sur les classes sous-repr√©sent√©es:
```bash
python cli.py train --model tfidf-minilm --data-dir ./data --augment --augment-multiplier 3
```

### Seuils Personnalis√©s
Ajustez les seuils de classification par classe:
```bash
python cli.py train --model tfidf-minilm --data-dir ./data --custom-thresholds
```

## üîÆ Exemple de Questions pour Test

### Math√©matiques
```bash
python cli.py predict --model-dir ./saved_models/tfidf_minilm \
  --questions "What is the derivative of x^2?" \
  "How to solve quadratic equations?" \
  "Explain integration by parts" \
  --verbose
```

### Utilisation avec fichier JSON
```bash
# Cr√©er un fichier questions.json
echo '[
  "What is the probability of getting two heads in a row?",
  "How to traverse a binary tree?",
  "Explain the Euclidean algorithm",
  "What is dynamic programming?"
]' > questions.json

# Pr√©dire et sauvegarder les r√©sultats
python cli.py predict \
  --model-dir ./saved_models/tfidf_minilm \
  --input-file questions.json \
  --output-file predictions.json \
  --verbose \
  --top-k 5
```

## üìù Notes

- Les mod√®les sauvegard√©s incluent le type de mod√®le pour un chargement automatique
- La fonction `predict_questions` d√©tecte automatiquement le type de mod√®le (TfidfLogReg ou TfidfMiniLM)
- Le mode `--verbose` affiche les probabilit√©s pour chaque tag pr√©dit
- Les seuils personnalis√©s permettent d'ajuster la sensibilit√© pour chaque classe